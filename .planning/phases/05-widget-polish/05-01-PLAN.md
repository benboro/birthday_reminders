---
phase: 05-widget-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - BirthdayRemindersWidget/Provider/BirthdayTimelineEntry.swift
  - BirthdayRemindersWidget/Provider/BirthdayTimelineProvider.swift
  - BirthdayRemindersWidget/Views/HomeScreen/LargeWidgetView.swift
  - BirthdayRemindersWidget/Views/HomeScreen/MediumWidgetView.swift
  - BirthdayRemindersWidget/Views/LockScreen/InlineWidgetView.swift
  - BirthdayReminders/Resources/Assets.xcassets/Contents.json
  - BirthdayReminders/Resources/Assets.xcassets/AppIcon.appiconset/Contents.json
  - BirthdayReminders/Resources/Assets.xcassets/AppIcon.appiconset/AppIcon.png
autonomous: true

must_haves:
  truths:
    - "Large widget today-highlighted row is visually aligned with all other rows (no extra margin or indentation)"
    - "Inline lock screen widget shows first name with relative text ('tomorrow', 'in 3 days', 'today') and falls back from full name to first name via ViewThatFits"
    - "Medium home screen widget displays 4 entries instead of 3"
    - "App displays the birthday calendar image as its app icon"
  artifacts:
    - path: "BirthdayRemindersWidget/Provider/BirthdayTimelineEntry.swift"
      provides: "WidgetBirthday with firstName field"
      contains: "let firstName: String"
    - path: "BirthdayRemindersWidget/Provider/BirthdayTimelineProvider.swift"
      provides: "firstName passed from Person model"
      contains: "firstName: person.firstName"
    - path: "BirthdayRemindersWidget/Views/HomeScreen/LargeWidgetView.swift"
      provides: "Uniform padding on all rows"
      contains: ".padding(.horizontal, 6)"
    - path: "BirthdayRemindersWidget/Views/HomeScreen/MediumWidgetView.swift"
      provides: "4-entry display"
      contains: "prefix(4)"
    - path: "BirthdayRemindersWidget/Views/LockScreen/InlineWidgetView.swift"
      provides: "ViewThatFits progressive fallback with firstName"
      contains: "ViewThatFits"
    - path: "BirthdayReminders/Resources/Assets.xcassets/AppIcon.appiconset/Contents.json"
      provides: "App icon asset catalog config"
      contains: "AppIcon.png"
    - path: "BirthdayReminders/Resources/Assets.xcassets/AppIcon.appiconset/AppIcon.png"
      provides: "1024x1024 app icon image"
    - path: "BirthdayReminders/Resources/Assets.xcassets/Contents.json"
      provides: "Asset catalog root marker"
      contains: "xcode"
  key_links:
    - from: "BirthdayRemindersWidget/Views/LockScreen/InlineWidgetView.swift"
      to: "BirthdayRemindersWidget/Provider/BirthdayTimelineEntry.swift"
      via: "birthday.firstName property access"
      pattern: "birthday\\.firstName"
    - from: "BirthdayRemindersWidget/Provider/BirthdayTimelineProvider.swift"
      to: "BirthdayRemindersWidget/Provider/BirthdayTimelineEntry.swift"
      via: "WidgetBirthday initializer with firstName parameter"
      pattern: "firstName: person\\.firstName"
    - from: "BirthdayReminders/Resources/Assets.xcassets/AppIcon.appiconset/Contents.json"
      to: "BirthdayReminders/Resources/Assets.xcassets/AppIcon.appiconset/AppIcon.png"
      via: "filename reference in Contents.json"
      pattern: "AppIcon\\.png"
---

<objective>
Polish widget views and add app icon based on UAT feedback.

Purpose: Address four cosmetic issues from user acceptance testing -- large widget row alignment, inline widget verbosity, medium widget density -- plus add the user-provided birthday calendar image as the app icon.
Output: Updated widget views with consistent alignment, concise inline text, more medium entries, and a working app icon in the asset catalog.
</objective>

<execution_context>
@C:/Users/bmbor/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/bmbor/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-widget-polish/05-RESEARCH.md
@BirthdayRemindersWidget/Provider/BirthdayTimelineEntry.swift
@BirthdayRemindersWidget/Provider/BirthdayTimelineProvider.swift
@BirthdayRemindersWidget/Views/HomeScreen/LargeWidgetView.swift
@BirthdayRemindersWidget/Views/HomeScreen/MediumWidgetView.swift
@BirthdayRemindersWidget/Views/LockScreen/InlineWidgetView.swift
@BirthdayReminders/Models/Person.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix widget data model and all three widget views</name>
  <files>
    BirthdayRemindersWidget/Provider/BirthdayTimelineEntry.swift
    BirthdayRemindersWidget/Provider/BirthdayTimelineProvider.swift
    BirthdayRemindersWidget/Views/HomeScreen/LargeWidgetView.swift
    BirthdayRemindersWidget/Views/HomeScreen/MediumWidgetView.swift
    BirthdayRemindersWidget/Views/LockScreen/InlineWidgetView.swift
  </files>
  <action>
    **Step 1 — Add firstName to WidgetBirthday (BirthdayTimelineEntry.swift):**
    Add `let firstName: String` field after the existing `name` field. Update all three placeholder entries to include firstName values:
    - `WidgetBirthday(name: "John Doe", firstName: "John", daysUntil: 0, month: 2, day: 15, year: 1990)`
    - `WidgetBirthday(name: "Jane Smith", firstName: "Jane", daysUntil: 3, month: 2, day: 18, year: nil)`
    - `WidgetBirthday(name: "Bob Wilson", firstName: "Bob", daysUntil: 7, month: 2, day: 22, year: 1985)`

    **Step 2 — Pass firstName from Person in provider (BirthdayTimelineProvider.swift):**
    In the `fetchEntry()` method, add `firstName: person.firstName` to the WidgetBirthday initializer call (line 47 area), between `name:` and `daysUntil:`.

    **Step 3 — Fix LargeWidgetView uniform padding (LargeWidgetView.swift):**
    Replace lines 44-45 (the conditional padding):
    ```
    .padding(.horizontal, birthday.daysUntil == 0 ? 6 : 0)
    .padding(.vertical, birthday.daysUntil == 0 ? 4 : 0)
    ```
    With uniform padding applied to ALL rows:
    ```
    .padding(.horizontal, 6)
    .padding(.vertical, 4)
    ```
    Keep the existing `.background(...)` block unchanged -- it already applies the accent color conditionally on `daysUntil == 0`.

    **Step 4 — Increase MediumWidgetView to 4 entries (MediumWidgetView.swift):**
    - Change `prefix(3)` to `prefix(4)` on line 16
    - Change the divider guard from `min(entry.upcomingBirthdays.count, 3) - 1` to `min(entry.upcomingBirthdays.count, 4) - 1` on line 28
    - Update the doc comment on line 4 from "next 3" to "next 4"

    **Step 5 — Rewrite InlineWidgetView with ViewThatFits (InlineWidgetView.swift):**
    Replace the entire body with:
    ```swift
    var body: some View {
        if let birthday = entry.upcomingBirthdays.first {
            let icon = birthday.daysUntil == 0 ? "gift.fill" : "gift"
            let fullText = birthday.daysUntil == 0
                ? "\(birthday.name)'s birthday!"
                : "\(birthday.name) \(birthday.daysUntilText)"
            let shortText = birthday.daysUntil == 0
                ? "\(birthday.firstName)'s birthday!"
                : "\(birthday.firstName) \(birthday.daysUntilText)"

            ViewThatFits {
                Text("\(Image(systemName: icon)) \(fullText)")
                Text("\(Image(systemName: icon)) \(shortText)")
            }
        } else {
            Text("No upcoming birthdays")
        }
    }
    ```
    Use computed `let` bindings (not conditionals inside ViewThatFits children) so each child is a single concrete Text view. ViewThatFits will try the full-name variant first and fall back to first-name if it doesn't fit.
  </action>
  <verify>
    Grep for these patterns to confirm changes:
    - `firstName: String` in BirthdayTimelineEntry.swift
    - `firstName: person.firstName` in BirthdayTimelineProvider.swift
    - `.padding(.horizontal, 6)` without conditional in LargeWidgetView.swift (no ternary on that line)
    - `prefix(4)` in MediumWidgetView.swift
    - `ViewThatFits` in InlineWidgetView.swift
    - `birthday.firstName` in InlineWidgetView.swift
  </verify>
  <done>
    WidgetBirthday has firstName field. All placeholder data includes firstName. Provider passes firstName from Person model. LargeWidgetView applies uniform 6pt horizontal and 4pt vertical padding to every row (highlight is background-only). MediumWidgetView shows up to 4 entries. InlineWidgetView uses ViewThatFits with full-name-first, first-name fallback for both today and non-today cases.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add app icon to asset catalog</name>
  <files>
    BirthdayReminders/Resources/Assets.xcassets/Contents.json
    BirthdayReminders/Resources/Assets.xcassets/AppIcon.appiconset/Contents.json
    BirthdayReminders/Resources/Assets.xcassets/AppIcon.appiconset/AppIcon.png
  </files>
  <action>
    **Step 1 — Create the asset catalog root Contents.json:**
    Create `BirthdayReminders/Resources/Assets.xcassets/Contents.json` with the standard empty catalog marker:
    ```json
    {
      "info" : {
        "author" : "xcode",
        "version" : 1
      }
    }
    ```
    The Assets.xcassets directory already exists but is empty. This file is required for Xcode to recognize it as a valid asset catalog.

    **Step 2 — Create the AppIcon.appiconset directory and Contents.json:**
    Create `BirthdayReminders/Resources/Assets.xcassets/AppIcon.appiconset/Contents.json`:
    ```json
    {
      "images" : [
        {
          "filename" : "AppIcon.png",
          "idiom" : "universal",
          "platform" : "ios",
          "size" : "1024x1024"
        }
      ],
      "info" : {
        "author" : "xcode",
        "version" : 1
      }
    }
    ```
    This uses the single-size universal format (standard since Xcode 14). The project.yml already has `ASSETCATALOG_COMPILER_APPICON_NAME: AppIcon` which matches this appiconset name.

    **Step 3 — Move the icon image:**
    Copy `image_1771220027532774.png` from the project root to `BirthdayReminders/Resources/Assets.xcassets/AppIcon.appiconset/AppIcon.png`. Then delete the original `image_1771220027532774.png` from the project root. Use `cp` then `rm` (not `mv`) to ensure the copy succeeds before deleting. Use `git rm` for the original if it's tracked, or plain `rm` if untracked.
  </action>
  <verify>
    - File exists: `BirthdayReminders/Resources/Assets.xcassets/Contents.json`
    - File exists: `BirthdayReminders/Resources/Assets.xcassets/AppIcon.appiconset/Contents.json`
    - File exists: `BirthdayReminders/Resources/Assets.xcassets/AppIcon.appiconset/AppIcon.png`
    - Original `image_1771220027532774.png` no longer exists at project root
    - Contents.json references `AppIcon.png` with `idiom: universal` and `size: 1024x1024`
  </verify>
  <done>
    Asset catalog has root Contents.json. AppIcon.appiconset contains the 1024x1024 birthday calendar PNG and its Contents.json with universal/ios single-size configuration. The original image file is removed from the project root. XcodeGen's ASSETCATALOG_COMPILER_APPICON_NAME already points to "AppIcon" matching the appiconset name.
  </done>
</task>

</tasks>

<verification>
1. Grep all modified widget files for the expected patterns (firstName, uniform padding, prefix(4), ViewThatFits)
2. Verify asset catalog structure: root Contents.json + AppIcon.appiconset/Contents.json + AppIcon.png all present
3. Verify original image removed from project root
4. No references to the old image filename remain in tracked files
</verification>

<success_criteria>
- LargeWidgetView applies identical padding to every row; today-row differs only by background color
- InlineWidgetView uses ViewThatFits with full-name and first-name variants
- MediumWidgetView displays up to 4 entries
- App icon is configured in the asset catalog with a 1024x1024 PNG
- No leftover image file at project root
</success_criteria>

<output>
After completion, create `.planning/phases/05-widget-polish/05-01-SUMMARY.md`
</output>
