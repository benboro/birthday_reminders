---
phase: 04-widgets
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - BirthdayRemindersWidget/BirthdayRemindersWidget.swift
  - BirthdayRemindersWidget/Views/HomeScreen/HomeWidgetEntryView.swift
  - BirthdayRemindersWidget/Views/HomeScreen/SmallWidgetView.swift
  - BirthdayRemindersWidget/Views/HomeScreen/MediumWidgetView.swift
  - BirthdayRemindersWidget/Views/HomeScreen/LargeWidgetView.swift
  - BirthdayRemindersWidget/Views/LockScreen/LockScreenWidgetEntryView.swift
  - BirthdayRemindersWidget/Views/LockScreen/CircularWidgetView.swift
  - BirthdayRemindersWidget/Views/LockScreen/RectangularWidgetView.swift
  - BirthdayRemindersWidget/Views/LockScreen/InlineWidgetView.swift
autonomous: true

must_haves:
  truths:
    - "User can add small, medium, or large home screen widgets showing upcoming birthdays"
    - "User can add a lock screen widget showing the next upcoming birthday"
    - "All widget views handle the empty state (no birthdays) gracefully"
    - "Home screen widgets use containerBackground for correct StandBy mode rendering"
    - "Lock screen widgets apply privacySensitive to redact names when device is locked"
  artifacts:
    - path: "BirthdayRemindersWidget/BirthdayRemindersWidget.swift"
      provides: "WidgetBundle with home and lock screen widgets"
      contains: "BirthdayRemindersWidgetBundle"
    - path: "BirthdayRemindersWidget/Views/HomeScreen/SmallWidgetView.swift"
      provides: "systemSmall widget showing next 1 birthday"
      contains: "struct SmallWidgetView"
    - path: "BirthdayRemindersWidget/Views/HomeScreen/MediumWidgetView.swift"
      provides: "systemMedium widget showing next 3-4 birthdays"
      contains: "struct MediumWidgetView"
    - path: "BirthdayRemindersWidget/Views/HomeScreen/LargeWidgetView.swift"
      provides: "systemLarge widget showing next 6-8 birthdays"
      contains: "struct LargeWidgetView"
    - path: "BirthdayRemindersWidget/Views/LockScreen/CircularWidgetView.swift"
      provides: "accessoryCircular days countdown gauge"
      contains: "struct CircularWidgetView"
    - path: "BirthdayRemindersWidget/Views/LockScreen/RectangularWidgetView.swift"
      provides: "accessoryRectangular name + days display"
      contains: "struct RectangularWidgetView"
    - path: "BirthdayRemindersWidget/Views/LockScreen/InlineWidgetView.swift"
      provides: "accessoryInline single-line text"
      contains: "struct InlineWidgetView"
  key_links:
    - from: "BirthdayRemindersWidget/BirthdayRemindersWidget.swift"
      to: "BirthdayRemindersWidget/Provider/BirthdayTimelineProvider.swift"
      via: "StaticConfiguration references BirthdayTimelineProvider"
      pattern: "BirthdayTimelineProvider"
    - from: "BirthdayRemindersWidget/Views/HomeScreen/HomeWidgetEntryView.swift"
      to: "BirthdayRemindersWidget/Views/HomeScreen/*.swift"
      via: "widgetFamily environment switch dispatching to size-specific views"
      pattern: "widgetFamily"
    - from: "BirthdayRemindersWidget/Views/LockScreen/LockScreenWidgetEntryView.swift"
      to: "BirthdayRemindersWidget/Views/LockScreen/*.swift"
      via: "widgetFamily environment switch dispatching to accessory views"
      pattern: "widgetFamily"
---

<objective>
Build all widget views for home screen (small, medium, large) and lock screen (circular, rectangular, inline) placements, plus the WidgetBundle entry point that registers both widget types.

Purpose: Complete the user-facing widget experience so users can glance at upcoming birthdays from the home screen or lock screen without opening the app.
Output: Fully functional home screen and lock screen widgets with appropriate layouts per size, empty state handling, and privacy redaction on lock screen.
</objective>

<execution_context>
@C:/Users/bmbor/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/bmbor/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-widgets/04-RESEARCH.md
@.planning/phases/04-widgets/04-01-SUMMARY.md

Key files from Plan 04-01:
@BirthdayRemindersWidget/Provider/BirthdayTimelineEntry.swift
@BirthdayRemindersWidget/Provider/BirthdayTimelineProvider.swift
@BirthdayReminders/Services/BirthdayCalculator.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create home screen widget views and entry view dispatcher</name>
  <files>
    BirthdayRemindersWidget/Views/HomeScreen/HomeWidgetEntryView.swift
    BirthdayRemindersWidget/Views/HomeScreen/SmallWidgetView.swift
    BirthdayRemindersWidget/Views/HomeScreen/MediumWidgetView.swift
    BirthdayRemindersWidget/Views/HomeScreen/LargeWidgetView.swift
  </files>
  <action>
1. Create `SmallWidgetView.swift` (systemSmall -- shows next 1 birthday):
   - Takes `entry: BirthdayTimelineEntry`
   - If first birthday exists: VStack(alignment: .leading, spacing: 4) with daysUntilText (caption2, semibold, accent color if daysUntil==0 else secondary), name (headline, lineLimit 2), formatted birthday date using `BirthdayCalculator.formattedBirthday(month:day:year:)` (caption, secondary)
   - If no birthdays: "No upcoming birthdays" in caption, secondary color
   - Frame maxWidth/maxHeight .infinity, alignment .topLeading
   - See research SmallWidgetView example for exact layout.

2. Create `MediumWidgetView.swift` (systemMedium -- shows next 3 birthdays):
   - Takes `entry: BirthdayTimelineEntry`
   - If birthdays exist: VStack(alignment: .leading, spacing: 6) iterating over `entry.upcomingBirthdays.prefix(3)`. Each row is an HStack with: name (subheadline, lineLimit 1, frame maxWidth .infinity alignment .leading), daysUntilText (caption, secondary, aligned trailing). Use Divider between rows but not after the last one.
   - If no birthdays: centered "No upcoming birthdays" text
   - Frame maxWidth/maxHeight .infinity, alignment .topLeading

3. Create `LargeWidgetView.swift` (systemLarge -- shows next 7 birthdays):
   - Takes `entry: BirthdayTimelineEntry`
   - If birthdays exist: VStack(alignment: .leading, spacing: 4) with header Text("Upcoming Birthdays") in caption, fontWeight semibold, foregroundStyle secondary, then ForEach over `entry.upcomingBirthdays.prefix(7)`. Each row: HStack with VStack(alignment: .leading) of name (subheadline, lineLimit 1) and formatted date (caption2, secondary), then Spacer, then daysUntilText (caption, secondary). Use Divider between rows.
   - Today's birthday row gets accent color background with rounded rect (same pattern as BirthdayListView today highlighting: `Color.accentColor.opacity(0.1)`)
   - If no birthdays: VStack with gift icon (system name "gift", font .largeTitle, secondary) and "No upcoming birthdays" text
   - Frame maxWidth/maxHeight .infinity, alignment .topLeading

4. Create `HomeWidgetEntryView.swift` (dispatcher):
   - Takes `entry: BirthdayTimelineEntry`
   - Reads `@Environment(\.widgetFamily) var widgetFamily`
   - Group containing switch on widgetFamily: .systemSmall -> SmallWidgetView, .systemMedium -> MediumWidgetView, .systemLarge -> LargeWidgetView, default -> EmptyView()
   - Apply `.containerBackground(.fill.tertiary, for: .widget)` on the Group
   - Import WidgetKit and SwiftUI.

All views import SwiftUI. WidgetBirthday and BirthdayTimelineEntry are available from Plan 04-01 provider files (same target).
  </action>
  <verify>
    Verify all four view files exist. Verify HomeWidgetEntryView reads widgetFamily and dispatches to three size-specific views. Verify containerBackground is applied. Verify empty state text exists in each size view.
  </verify>
  <done>
    Home screen widgets render upcoming birthdays at three sizes (1, 3, and 7 entries respectively) with empty state handling, today highlighting on large size, and containerBackground for StandBy mode.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create lock screen widget views, entry dispatcher, and WidgetBundle</name>
  <files>
    BirthdayRemindersWidget/Views/LockScreen/LockScreenWidgetEntryView.swift
    BirthdayRemindersWidget/Views/LockScreen/CircularWidgetView.swift
    BirthdayRemindersWidget/Views/LockScreen/RectangularWidgetView.swift
    BirthdayRemindersWidget/Views/LockScreen/InlineWidgetView.swift
    BirthdayRemindersWidget/BirthdayRemindersWidget.swift
  </files>
  <action>
1. Create `CircularWidgetView.swift` (accessoryCircular -- days countdown gauge):
   - Takes `entry: BirthdayTimelineEntry`
   - If first birthday exists: Gauge(value: Double(max(0, 30 - birthday.daysUntil)), in: 0...30) with currentValueLabel showing daysUntil as large rounded text. Use `.gaugeStyle(.accessoryCircularCapacity)`.
   - If no birthdays: ZStack with AccessoryWidgetBackground() and Image(systemName: "gift")
   - Import WidgetKit and SwiftUI.

2. Create `RectangularWidgetView.swift` (accessoryRectangular -- name + days):
   - Takes `entry: BirthdayTimelineEntry`
   - If first birthday exists: VStack(alignment: .leading, spacing: 2) with name (headline, lineLimit 1) and daysUntilText (caption, if daysUntil==0 prepend gift.fill icon via string interpolation with Image(systemName:))
   - Apply `.privacySensitive()` on the name Text to redact when device is locked (aligns with SECR-04 privacy-first approach)
   - If no birthdays: Text("No upcoming birthdays") in caption
   - Import WidgetKit and SwiftUI.

3. Create `InlineWidgetView.swift` (accessoryInline -- single line):
   - Takes `entry: BirthdayTimelineEntry`
   - If first birthday exists and daysUntil==0: `Text("\(Image(systemName: "gift.fill")) \(birthday.name)'s birthday!")`
   - If first birthday exists and daysUntil>0: `Text("\(Image(systemName: "gift")) \(birthday.name) \(birthday.daysUntilText)")`
   - If no birthdays: Text("No upcoming birthdays")
   - Import WidgetKit and SwiftUI.

4. Create `LockScreenWidgetEntryView.swift` (dispatcher):
   - Takes `entry: BirthdayTimelineEntry`
   - Reads `@Environment(\.widgetFamily) var widgetFamily`
   - Group containing switch on widgetFamily: .accessoryCircular -> CircularWidgetView, .accessoryRectangular -> RectangularWidgetView, .accessoryInline -> InlineWidgetView, default -> EmptyView()
   - Apply `.containerBackground(.fill.tertiary, for: .widget)`
   - Import WidgetKit and SwiftUI.

5. Create `BirthdayRemindersWidget/BirthdayRemindersWidget.swift` -- the @main WidgetBundle entry point:
   - `@main struct BirthdayRemindersWidgetBundle: WidgetBundle` with body containing `BirthdayHomeWidget()` and `BirthdayLockScreenWidget()`
   - `struct BirthdayHomeWidget: Widget` with kind "BirthdayHomeWidget", StaticConfiguration using BirthdayTimelineProvider, entry view HomeWidgetEntryView, configurationDisplayName "Upcoming Birthdays", description "See upcoming birthdays at a glance.", supportedFamilies [.systemSmall, .systemMedium, .systemLarge]
   - `struct BirthdayLockScreenWidget: Widget` with kind "BirthdayLockScreenWidget", StaticConfiguration using BirthdayTimelineProvider, entry view LockScreenWidgetEntryView, configurationDisplayName "Next Birthday", description "See the next upcoming birthday.", supportedFamilies [.accessoryCircular, .accessoryRectangular, .accessoryInline]
   - Import WidgetKit and SwiftUI.
   - See research Pattern 1 (WidgetBundle with Two Widgets) for exact structure.
  </action>
  <verify>
    Verify all five files exist. Verify BirthdayRemindersWidgetBundle has @main attribute. Verify both BirthdayHomeWidget and BirthdayLockScreenWidget structs exist with correct supportedFamilies. Verify CircularWidgetView uses gaugeStyle(.accessoryCircularCapacity). Verify RectangularWidgetView uses .privacySensitive(). Verify InlineWidgetView handles both birthday-today and future-birthday cases.
  </verify>
  <done>
    Lock screen widgets render next birthday in three accessory formats (circular gauge, rectangular name+days, inline text) with privacy redaction. WidgetBundle registers both home screen and lock screen widgets with correct supported families. Widget gallery shows two distinct entries: "Upcoming Birthdays" (home) and "Next Birthday" (lock screen).
  </done>
</task>

</tasks>

<verification>
- WidgetBundle has @main and contains both BirthdayHomeWidget and BirthdayLockScreenWidget
- Home screen widget supports .systemSmall, .systemMedium, .systemLarge
- Lock screen widget supports .accessoryCircular, .accessoryRectangular, .accessoryInline
- All views use .containerBackground(.fill.tertiary, for: .widget)
- All views handle empty birthday list gracefully (no crashes, shows placeholder text)
- Lock screen rectangular widget uses .privacySensitive() on name text
- SmallWidgetView shows 1 birthday, MediumWidgetView shows 3, LargeWidgetView shows 7
- CircularWidgetView uses gauge with .accessoryCircularCapacity style
- InlineWidgetView uses SF Symbol string interpolation for gift icon
- No networking code, no third-party imports (SECR-01, SECR-03)
</verification>

<success_criteria>
All six widget views render correctly for their respective sizes. WidgetBundle entry point registers both home screen and lock screen widgets. Empty states handled in all views. Privacy-sensitive modifier applied to lock screen name display.
</success_criteria>

<output>
After completion, create `.planning/phases/04-widgets/04-02-SUMMARY.md`
</output>
